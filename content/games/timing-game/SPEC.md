# 시간 맞추기 게임 – 명세 (현재 구현 기준)

웹 멀티플레이어 게임. 정해진 목표 초가 되었을 때 버튼을 누르는 타이밍을 겨룬다.

---

## 1. 게임 개념

- **이름**: 시간 맞추기 게임
- **규칙**: 목표 초(예: 5초)가 정해지면, **시작 신호 후 정확히 그 시간이 되는 순간**에 버튼을 누른 사람이 이긴다.
- **승자**: 목표 시점에 가장 가까운 시점에 누른 사람이 해당 라운드 승자.

---

## 2. 멀티플레이

- **방 생성**: 한 사람이 방을 만든다.
  - **방 제목**은 선택(비워 두면 기본값 "대기실"). "방 만들기" 화면에서만 입력하며, 입장 시에는 방 코드만 사용한다.
- **방 코드**: **6자리 숫자**. 링크 공유 시 `?code=123456` 형태로 전달 가능.
- **입장**: 방 코드 입력 또는 링크로 입장.
- **방 인원 제한**: 없음.
- **진행**: 같은 방 참가자들이 동시에 한 라운드 진행. 모두 같은 시작 시점·같은 목표 초를 맞추는 대결.
- **호스트 나가면**: 방이 **삭제**되어 종료(방 폭파). 참가자는 나가기만 가능.

---

## 3. 라운드

- **목표 시간**: 매 라운드 **5~10초** 구간에서 **서버에서 랜덤** 설정(Edge Function).
- **시작**: **호스트만** "시작" 버튼으로 라운드 시작. 서버가 `start_at = now() + 4초`로 라운드를 생성해 모든 클라이언트에 동일 시작 시각을 전달.
- **카운트다운**: 시작 직전 **4, 3, 2, 1** 카운트다운(약 4초) 후 "시작!" 순간을 **공통 시작 시각**으로 사용.
- **버튼 규칙**: 라운드당 **한 번만** 누르기. 조기 누르기는 실격 없이 **오차만** 표시해 순위에 포함. 라운드 종료 시까지 안 누르면 **기권** 처리(순위 맨 뒤).
- **종료 후**: 한 라운드가 끝나도 **방은 유지**되며, 대기실로 돌아가 다음 라운드를 **반복**할 수 있다.

---

## 4. 플레이어·UI

- **닉네임**: **필수**. **게임 첫 화면**에서 입력 후 "방 만들기" 또는 "방 들어가기" 선택. 로컬 저장 후 재사용.
- **승리 횟수**: 각 플레이어별로 몇 번 이겼는지 대기실·라운드 화면에 닉네임 옆 **"(N승)"** 형태로 표시.
- **결과 표시**: 라운드 종료 시 **모든 참가자**에게 동일하게 표시.
  - 순위: 1st, 2nd, 3rd … (가까운 순). **1~3등**은 금·은·동 메달 색으로 강조.
  - 각자 **목표 대비 오차**: **초 단위**(소수 둘째 자리). 예: 오차: +0.12(늦음), 오차: −0.30(빨름).
- **플레이어 번호**: P1, P2, … P8. 각 번호는 색상 배지로 구분하며, P1은 노란색 배지.

---

## 5. 플랫폼·서버·배포

- **웹**: 블로그/게임 페이지에서 웹으로 제공.
- **실시간·백엔드**: **Supabase** (Realtime + Postgres). 방·참가자·라운드·누른 시각을 DB로 관리하고 Realtime으로 동기화.
- **Edge Function**:
  - `start-round`: 호스트만 호출. `rounds`에 `start_at = now() + 4초`, `target_seconds = 5~10` 랜덤 insert.
  - `get-server-time`: 클라이언트 시계 오차 보정용 서버 시각 반환.
- **배포**: 블로그 페이지에 iframe 등으로 게임 삽입. 게임 진입 URL은 블로그 도메인 유지.

---

## 6. 기타 구현 사항

- **BGM**: 6곡. 같은 방에서는 **같은 BGM**이 나오도록, 클라이언트에서 `round.id % 6`으로 선택(서버에서는 지정하지 않음).
- **BGM on/off**: 대기실·라운드에서 BGM 토글 버튼 제공.
- **새로고침**: 대기실 등에서 새로고침 버튼 제공.
